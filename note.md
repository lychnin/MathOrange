# 时间序列分析以及股票中间价预测代码分析
[toc]
## 针对时间序列的相关检验
#### 检验是否为白噪声
#### 是否平稳

##### 自相关系数与偏相关系数相关分析
自相关分析与偏相关分析是用来确定ARIMA中p与q参数的方法

![](images/2023-08-02-09-13-50.png)

![](images/2023-08-02-09-14-13.png)

![](images/2023-08-02-09-08-23.png)

如果为随机序列就没有分析价值

##### 平稳性检验
如果是平稳的可以使用ARMA预测
如果不平稳，则需要使用差分移动自回归模型预测，使用单位根检验

![](images/2023-08-02-09-10-31.png)

![](images/2023-08-02-09-10-50.png)

p值小于0.05说明平稳，否则不平稳

##### KPSS检验
![](images/2023-08-02-09-11-47.png)

![](images/2023-08-02-09-12-19.png)

![](images/2023-08-02-09-12-33.png)

##### 还可以对时间序列进行分解

  - 乘法模型分解
    ![](images/2023-08-02-09-15-20.png)


* 加法模型分解
    ![](images/2023-08-02-09-16-01.png)

  - 移动平均算法

数据的预处理
![](images/2023-08-02-09-18-15.png)

## 时间序列算法
### 简单移动平均
![](images/2023-08-02-09-19-00.png)
![](images/2023-08-02-09-19-14.png)

![](images/2023-08-02-09-19-27.png)

### 简单指数平滑法
![](images/2023-08-02-09-20-39.png)

![](images/2023-08-02-09-21-06.png)

### 霍尔特(Holt)线性趋势法

![](images/2023-08-02-09-21-53.png)

### Holt-Winter季节性预测模型

![](images/2023-08-02-09-22-48.png)

![](images/2023-08-02-09-22-58.png)

### ARIMA模型
#### AR模型
![](images/2023-08-02-09-24-07.png)

![](images/2023-08-02-09-24-35.png)
观察AIC与BIC是否显著

查看模型的拟合残差分布
![](images/2023-08-02-09-25-58.png)

得到的拟合残差并不是正态分布的说明数据中还有信息没有充分挖掘

![](images/2023-08-02-09-26-48.png)

![](images/2023-08-02-09-27-02.png)

#### ARMA模型
![](images/2023-08-02-09-27-56.png)

![](images/2023-08-02-09-28-04.png)

![](images/2023-08-02-09-28-18.png)

![](images/2023-08-02-09-28-57.png)

![](images/2023-08-02-09-29-14.png)


##### 自动搜索合适的参数
![](images/2023-08-02-09-29-40.png)

#### ARIMA模型
![](images/2023-08-02-09-30-55.png)
建立模型

残差
![](images/2023-08-02-09-31-11.png)

接近于正态分布

预测，输出置信区间

![](images/2023-08-02-09-31-33.png)

预测出了增长趋势但没有周期性趋势

#### SARIMA模型
季节性ARIMA模型

自动寻找合适参数

![](images/2023-08-02-09-33-42.png)


预测
![](images/2023-08-02-09-33-31.png)
![](images/2023-08-02-09-33-16.png)


## 时序数据预测——基础知识

相等时间间隔的时间段内依照给定的采样率对某种潜在过程进行预测。

#### 时序数据的组成:
基准值，某个常数的定值

#### 趋势，trand

#### 周期性，seasonality

#### 噪音，noise

#### 滑动窗口，sliding window method用前几个数据来预测当前的数据

#### lag method法

#### 特征工程:从一系列工程化的方式从原始数据中筛选出来更好的数据特征，用以提升模型的训练效果

#### 箱型图

#### 四分位数，25,50,75,100

#### 相关系数图
![](images/2023-08-02-09-41-24.png)

#### 重新采样

有时候粒度太细,或者粒度不够，上采样——数据变多，插值法

下采样——数据变少

#### 幂变换
数据是非平稳的，期望与方差随时间变化

#### boxcox
![](images/2023-08-02-09-47-52.png)

lambda可以自己找

#### 滑动平均平滑
Centered Moving Average
居中移动平均，去除趋势性与周期性，不能用于预测(因为用到了未来时间的值)



#### Trailing Moving Average
截尾移动平均，用于预测，但得先去除趋势性与周期性

<mark>前提是假设序列是平稳的，去除趋势与周期后才可使用</mark>
![](images/2023-08-02-09-50-35.png)


#### 白噪声
变量各自独立，且平均数为0

如果时序为白噪声，那么无法预测，预测模型输出的结果与实际结果的残差为白噪声，那么结果理想
## 代码逐行解析
![](images/2023-08-06-11-02-56.png)
![](images/2023-08-06-11-03-53.png)
![](images/2023-08-06-11-00-41.png)